for (j in 1:nrow(data)) {
if (is.na(data[j, i])) {
yd <- data[, i]
nx <- as.numeric(data[j, ])
nx <- nx[!is.na(nx)]
na_index <- which(!is.na(data[j, , drop = FALSE]))
data_p <- data[, na_index]
data_p <- cbind(y = yd, data_p)
data_p <- data_p[rowSums(is.na(data_p)) == 0, ]
data_rep[j,i]<-missing_value(data_p, nx)
}
}
}
View(data_p)
data_rep[j,i]<-missing_value(data_p, nx)
data_rep[j,i]<-mising_value(data_p, nx)
for (i in 1:ncol(data)) {
for (j in 1:nrow(data)) {
if (is.na(data[j, i])) {
yd <- data[, i]
nx <- as.numeric(data[j, ])
nx <- nx[!is.na(nx)]
na_index <- which(!is.na(data[j, , drop = FALSE]))
data_p <- data[, na_index]
data_p <- cbind(y = yd, data_p)
data_p <- data_p[rowSums(is.na(data_p)) == 0, ]
data_rep[j,i]<-mising_value(data_p, nx)
}
}
}
#////////////////////////////////////////////////////множественная линейная регрессия
mising_value <- function(data_p, nx){
pr_names<-c("y")
for(i in 2:ncol(data_p)) pr_names<-c(pr_names, paste("x", i-1, sep=""))
colnames(data_p)<-pr_names
f<-paste(pr_names[1], "~", sep="")
for(i in 2:length(pr_names)) f<-paste(f, "+", pr_names[i], sep="")
f<-as.formula(f)
fit <- lm(f, data=data_p)
newdata=data.frame(x=nx[1])
for(i in 2:length(nx)) newdata<-cbind(newdata, c(nx[i]))
colnames(newdata)<-pr_names[2:length(pr_names)]
predict(fit, newdata)[[1]]
}
data <- read_excel("E:/Eranthis/Tulips.xls")
pop<-data[,2]
data<-data[,-c(1:2)]
data_rep<-data
for (i in 1:ncol(data)) {
for (j in 1:nrow(data)) {
if (is.na(data[j, i])) {
yd <- data[, i]
nx <- as.numeric(data[j, ])
nx <- nx[!is.na(nx)]
na_index <- which(!is.na(data[j, , drop = FALSE]))
data_p <- data[, na_index]
data_p <- cbind(y = yd, data_p)
data_p <- data_p[rowSums(is.na(data_p)) == 0, ]
data_rep[j,i]<-mising_value(data_p, nx)
}
}
}
data_rep<-cbind(pop=pop, data_rep)
data<-data_rep
row_n<-data.frame(point=data[,1])
data<-data[,-1]
data_am<-data.frame(dep=data[,12], point=row_n)
fit <- aov(dep ~ point, data=data_am)
View(data)
#////////////////////////////////////////////////////множественная линейная регрессия
mising_value <- function(data_p, nx){
pr_names<-c("y")
for(i in 2:ncol(data_p)) pr_names<-c(pr_names, paste("x", i-1, sep=""))
colnames(data_p)<-pr_names
f<-paste(pr_names[1], "~", sep="")
for(i in 2:length(pr_names)) f<-paste(f, "+", pr_names[i], sep="")
f<-as.formula(f)
fit <- lm(f, data=data_p)
newdata=data.frame(x=nx[1])
for(i in 2:length(nx)) newdata<-cbind(newdata, c(nx[i]))
colnames(newdata)<-pr_names[2:length(pr_names)]
predict(fit, newdata)[[1]]
}
data <- read_excel("E:/Eranthis/Tulips.xls")
pop<-data[,2]
data<-data[,-c(1:2)]
data_rep<-data
for (i in 1:ncol(data)) {
for (j in 1:nrow(data)) {
if (is.na(data[j, i])) {
yd <- data[, i]
nx <- as.numeric(data[j, ])
nx <- nx[!is.na(nx)]
na_index <- which(!is.na(data[j, , drop = FALSE]))
data_p <- data[, na_index]
data_p <- cbind(y = yd, data_p)
data_p <- data_p[rowSums(is.na(data_p)) == 0, ]
data_rep[j,i]<-mising_value(data_p, nx)
}
}
}
data_rep<-cbind(pop=pop, data_rep)
data<-data_rep
row_n<-data.frame(point=data[,1])
View(data)
data_T <- read_excel("E:/Eranthis/Tulips.xls")
View(data_T)
View(data)
data_am<-data.frame(dep=data[,12], point=row_n)
fit <- aov(dep ~ point, data=data_am)
summary(fit)
a<-3.019
1-1/a
boxplot(dep ~ point, data=data_am)
for(i in 1:ncol(data)) data[,i]<-(data[,i]-mean(data[,i]))/sd(data[,i])
fit<-prcomp(data)
for(i in 1:ncol(data)){
data[,i]<-(data[,i]-mean(data[,i]))/sd(data[,i])
}
for (i in 1:ncol(data)) {
if (is.numeric(data[, i])) {
data[, i] <- (data[, i] - mean(data[, i], na.rm = TRUE)) / sd(data[, i], na.rm = TRUE)
} else {
warning(paste("Column", i, "is not numeric. Skipping..."))
}
}
for(i in 2:ncol(data)){
data[,i]<-(data[,i]-mean(data[,i]))/sd(data[,i])
}
fit<-prcomp(data)
fit<-prcomp(data[,2:12])
fviz_pca_biplot(fit, habillage=row_n[,1], addEllipses=T, pointsize = 6)
View(data)
# START -----------------------------------------------------------------------------------------------------------
Sys.setenv(LANG = "en_US.UTF-8")
#Library
library(pacman)
pacman::p_load(lubridate, purrr, dplyr, tidyr, forecast, zoo, rlang, ggplot2, tidyverse, raster,
sp, geodata, terra, rasterVis, BiocManager, dismo, XML, jsonlite, rgdal, rJava,
readxl, rgbif, factoextra, NbClust, cluster, openxlsx, caret, mice, missForest, knitr, htmltools,
FactoMineR, missMDA, pcaMethods, caret, ggfortify, gridExtra, hrbrthemes, corrplot, mice,
caTools, vegan, pvclust
)
#Empty Global Enviroment
rm(list = ls())
# Read all lists in file
file_path <- "E:/Eranthis/Eranthis_morph.xlsx"
all_sheets <- excel_sheets(file_path)
for (sheet_name in all_sheets) {
var_name <- make.names(sheet_name)
assign(var_name, read_excel(file_path, sheet = sheet_name))
}
all_dataframes <- list("E.sibirica", "E.tanhoensis", "E.sibirica_x_E.tanhoensis", "E.krasnoborovii", "E.sineli",
"E.stellata", "E.stellata.Korea.", "E.pinnatifida", "E.pungdoensis", "E.albiflora",
"E.lobulata", "E.byunsanensis")
#Making One table
tables <- lapply(all_dataframes, get)
tables <- lapply(tables, as.data.frame)
tables <- lapply(tables, function(tbl) mutate_all(tbl, as.character))
tables <- lapply(seq_along(all_dataframes), function(i) {
df <- get(all_dataframes[[i]])
df <- as.data.frame(mutate_all(df, as.character))
df <- df[complete.cases(df$Species), ]
df$Species <- all_dataframes[[i]]
return(df)
})
combined_data <- bind_rows(tables)
combined_data <- combined_data[, -c(1,3,45,46,47,48) ]
combined_data <- combined_data %>%
mutate_at(vars(2:42), ~as.numeric(.))
View(combined_data)
View(combined_data)
pop <- combined_data[,1]
data<-data[,-c(1)]
combined_data <- combined_data[,-c(1)]
data <- combined_data
data_rep <- combined_data
for (i in 1:ncol(data)) {
for (j in 1:nrow(data)) {
if (is.na(data[j, i])) {
yd <- data[, i]
nx <- as.numeric(data[j, ])
nx <- nx[!is.na(nx)]
na_index <- which(!is.na(data[j, , drop = FALSE]))
data_p <- data[, na_index]
data_p <- cbind(y = yd, data_p)
data_p <- data_p[rowSums(is.na(data_p)) == 0, ]
data_rep[j,i]<-mising_value(data_p, nx)
}
}
}
# START -----------------------------------------------------------------------------------------------------------
Sys.setenv(LANG = "en_US.UTF-8")
#Library
library(pacman)
pacman::p_load(lubridate, purrr, dplyr, tidyr, forecast, zoo, rlang, ggplot2, tidyverse, raster,
sp, geodata, terra, rasterVis, BiocManager, dismo, XML, jsonlite, rgdal, rJava,
readxl, rgbif, factoextra, NbClust, cluster, openxlsx, caret, mice, missForest, knitr, htmltools,
FactoMineR, missMDA, pcaMethods, caret, ggfortify, gridExtra, hrbrthemes, corrplot, mice,
caTools, vegan, pvclust
)
#Empty Global Enviroment
rm(list = ls())
# Read all lists in file
file_path <- "E:/Eranthis/Eranthis_morph.xlsx"
all_sheets <- excel_sheets(file_path)
for (sheet_name in all_sheets) {
var_name <- make.names(sheet_name)
assign(var_name, read_excel(file_path, sheet = sheet_name))
}
#Making One table
tables <- lapply(all_dataframes, get)
tables <- lapply(tables, as.data.frame)
tables <- lapply(tables, function(tbl) mutate_all(tbl, as.character))
tables <- lapply(seq_along(all_dataframes), function(i) {
df <- get(all_dataframes[[i]])
df <- as.data.frame(mutate_all(df, as.character))
df <- df[complete.cases(df$Species), ]
df$Species <- all_dataframes[[i]]
return(df)
})
#Empty Global Enviroment
rm(list = ls())
# Read all lists in file
file_path <- "E:/Eranthis/Eranthis_morph.xlsx"
all_sheets <- excel_sheets(file_path)
for (sheet_name in all_sheets) {
var_name <- make.names(sheet_name)
assign(var_name, read_excel(file_path, sheet = sheet_name))
}
all_dataframes <- list("E.sibirica", "E.tanhoensis", "E.sibirica_x_E.tanhoensis", "E.krasnoborovii", "E.sineli",
"E.stellata", "E.stellata.Korea.", "E.pinnatifida", "E.pungdoensis", "E.albiflora",
"E.lobulata", "E.byunsanensis")
#Making One table
tables <- lapply(all_dataframes, get)
tables <- lapply(tables, as.data.frame)
tables <- lapply(tables, function(tbl) mutate_all(tbl, as.character))
tables <- lapply(seq_along(all_dataframes), function(i) {
df <- get(all_dataframes[[i]])
df <- as.data.frame(mutate_all(df, as.character))
df <- df[complete.cases(df$Species), ]
df$Species <- all_dataframes[[i]]
return(df)
})
combined_data <- bind_rows(tables)
combined_data <- combined_data[, -c(1,3,45,46,47,48) ]
combined_data <- combined_data %>%
mutate_at(vars(2:42), ~as.numeric(.))
mising_value <- function(data_p, nx){
pr_names<-c("y")
for(i in 2:ncol(data_p)) pr_names<-c(pr_names, paste("x", i-1, sep=""))
colnames(data_p)<-pr_names
f<-paste(pr_names[1], "~", sep="")
for(i in 2:length(pr_names)) f<-paste(f, "+", pr_names[i], sep="")
f<-as.formula(f)
fit <- lm(f, data=data_p)
newdata=data.frame(x=nx[1])
for(i in 2:length(nx)) newdata<-cbind(newdata, c(nx[i]))
colnames(newdata)<-pr_names[2:length(pr_names)]
predict(fit, newdata)[[1]]
}
pop <- combined_data[,1]
combined_data <- combined_data[,-c(1)]
data <- combined_data
data_rep <- combined_data
for (i in 1:ncol(data)) {
for (j in 1:nrow(data)) {
if (is.na(data[j, i])) {
yd <- data[, i]
nx <- as.numeric(data[j, ])
nx <- nx[!is.na(nx)]
na_index <- which(!is.na(data[j, , drop = FALSE]))
data_p <- data[, na_index]
data_p <- cbind(y = yd, data_p)
data_p <- data_p[rowSums(is.na(data_p)) == 0, ]
data_rep[j,i]<-mising_value(data_p, nx)
}
}
}
yd <- data[, i]
nx <- as.numeric(data[j, ])
nx <- nx[!is.na(nx)]
na_index <- which(!is.na(data[j, , drop = FALSE]))
data_p <- data[, na_index]
data_p <- cbind(y = yd, data_p)
data_p <- data_p[rowSums(is.na(data_p)) == 0, ]
data_rep[j,i]<-mising_value(data_p, nx)
data_rep[j,i] <- mising_value(data_p, nx)
View(data_p)
#1,3,15,17,19,23,29,30,31
model_fr <- combined_data[ , c(1,3,5,7,9,13,15,17,19,21,23,29,30,31)]
mising_value <- function(data_p, nx){
pr_names<-c("y")
for(i in 2:ncol(data_p)) pr_names<-c(pr_names, paste("x", i-1, sep=""))
colnames(data_p)<-pr_names
f<-paste(pr_names[1], "~", sep="")
for(i in 2:length(pr_names)) f<-paste(f, "+", pr_names[i], sep="")
f<-as.formula(f)
fit <- lm(f, data=data_p)
newdata=data.frame(x=nx[1])
for(i in 2:length(nx)) newdata<-cbind(newdata, c(nx[i]))
colnames(newdata)<-pr_names[2:length(pr_names)]
predict(fit, newdata)[[1]]
}
pop <- model_fr[,1]
data <- model_fr[,-c(1)]
data_rep <- data
for (i in 1:ncol(data)) {
for (j in 1:nrow(data)) {
if (is.na(data[j, i])) {
yd <- data[, i]
nx <- as.numeric(data[j, ])
nx <- nx[!is.na(nx)]
na_index <- which(!is.na(data[j, , drop = FALSE]))
data_p <- data[, na_index]
data_p <- cbind(y = yd, data_p)
data_p <- data_p[rowSums(is.na(data_p)) == 0, ]
data_rep[j,i] <- mising_value(data_p, nx)
}
}
}
View(E.stellata)
View(model_fr)
View(E.albiflora)
View(data)
#Empty Global Enviroment
rm(list = ls())
# Read all lists in file
file_path <- "E:/Eranthis/Eranthis_morph.xlsx"
all_sheets <- excel_sheets(file_path)
for (sheet_name in all_sheets) {
var_name <- make.names(sheet_name)
assign(var_name, read_excel(file_path, sheet = sheet_name))
}
all_dataframes <- list("E.sibirica", "E.tanhoensis", "E.sibirica_x_E.tanhoensis", "E.krasnoborovii", "E.sineli",
"E.stellata", "E.stellata.Korea.", "E.pinnatifida", "E.pungdoensis", "E.albiflora",
"E.lobulata", "E.byunsanensis")
#Making One table
tables <- lapply(all_dataframes, get)
tables <- lapply(tables, as.data.frame)
tables <- lapply(tables, function(tbl) mutate_all(tbl, as.character))
tables <- lapply(seq_along(all_dataframes), function(i) {
df <- get(all_dataframes[[i]])
df <- as.data.frame(mutate_all(df, as.character))
df <- df[complete.cases(df$Species), ]
df$Species <- all_dataframes[[i]]
return(df)
})
combined_data <- bind_rows(tables)
combined_data <- combined_data[, -c(1,3,45,46,47,48) ]
combined_data <- combined_data %>%
mutate_at(vars(2:42), ~as.numeric(.))
#1,3,15,17,19,23,29,30,31
model_fr <- combined_data[ , c(1,3,5,7,9,13,15,17,19,21,23,29,30,31)]
mising_value <- function(data_p, nx){
pr_names<-c("y")
for(i in 2:ncol(data_p)) pr_names<-c(pr_names, paste("x", i-1, sep=""))
colnames(data_p)<-pr_names
f<-paste(pr_names[1], "~", sep="")
for(i in 2:length(pr_names)) f<-paste(f, "+", pr_names[i], sep="")
f<-as.formula(f)
fit <- lm(f, data=data_p)
newdata=data.frame(x=nx[1])
for(i in 2:length(nx)) newdata<-cbind(newdata, c(nx[i]))
colnames(newdata)<-pr_names[2:length(pr_names)]
predict(fit, newdata)[[1]]
}
pop <- model_fr[,1]
data <- model_fr[,-c(1)]
data_rep <- data
for (i in 1:ncol(data)) {
for (j in 1:nrow(data)) {
if (is.na(data[j, i])) {
yd <- data[, i]
nx <- as.numeric(data[j, ])
nx <- nx[!is.na(nx)]
na_index <- which(!is.na(data[j, , drop = FALSE]))
data_p <- data[, na_index]
data_p <- cbind(y = yd, data_p)
data_p <- data_p[rowSums(is.na(data_p)) == 0, ]
data_rep[j,i] <- mising_value(data_p, nx)
}
}
}
View(model_fr)
pop <- combined_data[,1]
data <- combined_data[,-c(1)]
data_rep <- data
for (i in 1:ncol(data)) {
for (j in 1:nrow(data)) {
if (is.na(data[j, i])) {
yd <- data[, i]
nx <- as.numeric(data[j, ])
nx <- nx[!is.na(nx)]
na_index <- which(!is.na(data[j, , drop = FALSE]))
data_p <- data[, na_index]
data_p <- cbind(y = yd, data_p)
data_p <- data_p[rowSums(is.na(data_p)) == 0, ]
data_rep[j,i] <- mising_value(data_p, nx)
}
}
}
#Empty Global Enviroment
rm(list = ls())
# Read all lists in file
file_path <- "E:/Eranthis/Eranthis_morph.xlsx"
all_sheets <- excel_sheets(file_path)
for (sheet_name in all_sheets) {
var_name <- make.names(sheet_name)
assign(var_name, read_excel(file_path, sheet = sheet_name))
}
all_dataframes <- list("E.sibirica", "E.tanhoensis", "E.sibirica_x_E.tanhoensis", "E.krasnoborovii", "E.sineli",
"E.stellata", "E.stellata.Korea.", "E.pinnatifida", "E.pungdoensis", "E.albiflora",
"E.lobulata", "E.byunsanensis")
#Making One table
tables <- lapply(all_dataframes, get)
tables <- lapply(tables, as.data.frame)
tables <- lapply(tables, function(tbl) mutate_all(tbl, as.character))
tables <- lapply(seq_along(all_dataframes), function(i) {
df <- get(all_dataframes[[i]])
df <- as.data.frame(mutate_all(df, as.character))
df <- df[complete.cases(df$Species), ]
df$Species <- all_dataframes[[i]]
return(df)
})
combined_data <- bind_rows(tables)
combined_data <- combined_data[, -c(1,3,45,46,47,48) ]
combined_data <- combined_data %>%
mutate_at(vars(2:42), ~as.numeric(.))
mising_value <- function(data_p, nx){
pr_names<-c("y")
for(i in 2:ncol(data_p)) pr_names<-c(pr_names, paste("x", i-1, sep=""))
colnames(data_p)<-pr_names
f<-paste(pr_names[1], "~", sep="")
for(i in 2:length(pr_names)) f<-paste(f, "+", pr_names[i], sep="")
f<-as.formula(f)
fit <- lm(f, data=data_p)
newdata=data.frame(x=nx[1])
for(i in 2:length(nx)) newdata<-cbind(newdata, c(nx[i]))
colnames(newdata)<-pr_names[2:length(pr_names)]
predict(fit, newdata)[[1]]
}
pop <- combined_data[,1]
data <- combined_data[,-c(1)]
data_rep <- data
for (i in 1:ncol(data)) {
for (j in 1:nrow(data)) {
if (is.na(data[j, i])) {
yd <- data[, i]
nx <- as.numeric(data[j, ])
nx <- nx[!is.na(nx)]
na_index <- which(!is.na(data[j, , drop = FALSE]))
data_p <- data[, na_index]
data_p <- cbind(y = yd, data_p)
data_p <- data_p[rowSums(is.na(data_p)) == 0, ]
data_rep[j,i] <- mising_value(data_p, nx)
}
}
}
for (i in 1:ncol(data)) {
for (j in 1:nrow(data)) {
if (is.na(data[j, i])) {
yd <- data[, i]
nx <- as.numeric(data[j, ])
nx <- nx[!is.na(nx)]
na_index <- which(!is.na(data[j, ]))
data_p <- data[, na_index]
data_p <- cbind(y = yd, data_p)
data_p <- data_p[rowSums(is.na(data_p)) == 0, ]
data_rep[j,i] <- mising_value(data_p, nx)
}
}
}
yd <- data[, i]
nx <- as.numeric(data[j, ])
nx <- nx[!is.na(nx)]
na_index <- which(!is.na(data[j, , drop = FALSE]))
data_p <- data[, na_index]
data_p <- cbind(y = yd, data_p)
data_p <- data_p[rowSums(is.na(data_p)) == 0, ]
data_rep[j,i] <- mising_value(data_p, nx)
pr_names<-c("y")
for(i in 2:ncol(data_p)) pr_names<-c(pr_names, paste("x", i-1, sep=""))
colnames(data_p)<-pr_names
f<-paste(pr_names[1], "~", sep="")
for(i in 2:length(pr_names)) f<-paste(f, "+", pr_names[i], sep="")
f<-as.formula(f)
fit <- lm(f, data=data_p)
fit <- lm(f, data=data_p, na.action = na.exclude)
fit <- lm(f, data=data_p, na.action = na.omit)
fit <- lm(f, data=data_p, na.action = "na.exclude")
fit <- lm(f, data=data_p, na.action = "na.omit")
fit <- lm(f, data=data_p, na.action = "na.fail")
fit <- lm(f, data=data_p, na.action=na.omit)
fit <- lm(f, data=data_p, na.action=na.eclude)
fit <- lm(f, data=data_p, na.action=na.exclude)
fit <- lm.fit(f, data=data_p, na.action=na.exclude)
set.seed(123)
split = sample.split(combined_data$PHfl, SplitRatio = 0.5)
training_set <- subset(combined_data, split == TRUE)
test_set <- subset(combined_data, split == FALSE)
sapply( lapply(training_set, unique), length)
training_set <- training_set[, colSums(is.na(training_set)) != nrow(training_set)]
values_count <- sapply(lapply(training_set, unique), length)
regressor = lm.fit(formula = PHfl ~ ., data = training_set, na.action = "na.omit")
regressor = lm.fit(formula = PHfl ~ ., data = training_set)
fit <- lm(f, data=data_p, na.rm = na.exclude)
fit <- lm(f, data=data_p, na.exclude = TRUE)
fit <- lm(f, data=data_p, na.omit = TRUE)
fit <- lm(f, data=data_p, na.rm = TRUE)
fit <- lm(f, data=data_p, na.action = na.exclude)
fit <- lm(f, data=data_p, na.action = na.exclude)
